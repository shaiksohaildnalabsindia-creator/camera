<select id="trackingSelect">
  <option value="">Select Tracking Number</option>
</select>

<br><br>

<input type="file" id="cameraInput" accept="image/*" capture="environment">
<button onclick="upload()">Upload</button>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwkH0fFkzRD0zwUZhiUhu8Y1a8Tx2CxBBOO4xc0SZgFMZ05nNiCqPM-RgXq6u0ShljgTQ/exec";

const select = document.getElementById("trackingSelect");

// Load today's tracking numbers
fetch(WEB_APP_URL)
  .then(r => r.json())
  .then(data => {
    // Filter out empty or "Unknown"
    const filtered = data.filter(x => x && x !== "Unknown");

    if (filtered.length === 0) {
      select.innerHTML = '<option value="">No tracking numbers today</option>';
    } else {
      select.innerHTML = '<option value="">Select Tracking Number</option>';
      filtered.forEach(tracking => {
        const option = document.createElement("option");
        option.value = tracking;
        option.textContent = tracking;
        select.appendChild(option);
      });
    }
  })
  .catch(err => {
    console.error(err);
    select.innerHTML = '<option value="">Error loading tracking numbers</option>';
  });

function upload() {
  const fileInput = document.getElementById("cameraInput");
  const tracking = select.value;

  if (!tracking) return alert("Select a tracking number");
  if (!fileInput.files[0]) return alert("Select an image");

  const reader = new FileReader();
  reader.onload = function(e) {
    fetch(WEB_APP_URL, {
      method: "POST",
      body: new URLSearchParams({
        image: e.target.result,
        tracking: tracking
      })
    })
    .then(r => r.json())
    .then(msg => {
      if (msg.success) {
        alert("Upload successful!\nURL: " + msg.url);
      } else if (msg.error) {
        alert("Error: " + msg.error);
      }
    })
    .catch(console.error);
  };
  reader.readAsDataURL(fileInput.files[0]);
}
</script>
